{% extends "base.html" %}
{% block content %}

<h3 class="fw-bold mb-4 text-primary">ğŸ“š í•™ìŠµìë£Œ & Q&A í†µí•© í˜ì´ì§€</h3>

<!-- âœ… ê²Œì‹œ í™•ì •ëœ ê°•ì˜ìë£Œ ëª©ë¡ -->
{% if lectures and lectures|length > 0 %}
  {% for lec in lectures %}
  <div class="border rounded p-3 mb-3 bg-light shadow-sm">
    <div class="d-flex justify-content-between">
      <h5 class="fw-bold text-primary">{{ lec.title or 'ì œëª© ì—†ìŒ' }}</h5>
      {% if is_professor %}
        <form method="POST" action="{{ url_for('delete_confirmed', index=loop.index0) }}">
          <button type="submit" class="btn btn-sm btn-outline-danger">ì‚­ì œ</button>
        </form>
      {% endif %}
    </div>
    <p class="mb-2">{{ lec.content or '' }}</p>

    {% if lec.files %}
      <p class="mb-1">ğŸ“ <b>ì²¨ë¶€ íŒŒì¼:</b>
        {% for f in (lec.files or '').split(';') if f.strip() %}
          <a href="{{ url_for('uploaded_file', filename=f.strip()) }}" target="_blank" class="text-decoration-none">{{ f.strip() }}</a>{% if not loop.last %}, {% endif %}
        {% endfor %}
      </p>
    {% endif %}

    {% if lec.links %}
      <p class="mb-1">ğŸ”— <b>ê´€ë ¨ ë§í¬:</b>
        {% for l in (lec.links or '').split(';') if l.strip() %}
          <a href="{{ l }}" target="_blank" class="text-decoration-none text-success">{{ l }}</a>{% if not loop.last %}, {% endif %}
        {% endfor %}
      </p>
    {% endif %}
    <small class="text-secondary">ğŸ“… {{ lec.date }}</small>
  </div>
  {% endfor %}
{% else %}
  <p class="text-muted">ì•„ì§ ê²Œì‹œëœ í•™ìŠµ ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
{% endif %}

<hr class="my-4">

<!-- ğŸ’¬ Q&A ì„¹ì…˜ -->
<h4 class="fw-bold text-dark mb-3">ğŸ’¬ í•™ìŠµ Q&A</h4>

<!-- âœ… ì§ˆë¬¸ ë“±ë¡ -->
<form method="POST" action="{{ url_for('add_question') }}" class="mb-4">
  <div class="card p-3 shadow-sm">
    <h6 class="fw-bold mb-2">ìƒˆ ì§ˆë¬¸ ë“±ë¡</h6>
    <input type="text" name="title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" class="form-control mb-2" required>
    <textarea name="content" rows="3" class="form-control mb-2" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
    <button type="submit" class="btn btn-primary btn-sm">ì§ˆë¬¸ ë“±ë¡</button>
  </div>
</form>

<!-- âœ… ì§ˆë¬¸ ëª©ë¡ -->
{% if questions and questions|length > 0 %}
  {% for q in questions %}
  <div class="card p-3 mb-3 shadow-sm">
    <div class="d-flex justify-content-between align-items-center">
      <h6 class="fw-bold">{{ q.title }}</h6>
      <small class="text-secondary">{{ q.date }}</small>
    </div>
    <p class="mb-2">{{ q.content }}</p>
    <p class="mb-2 text-muted small">ì‘ì„±ì: {{ q.email }}</p>

    <!-- âœï¸ ìˆ˜ì •/ì‚­ì œ (ì‘ì„±ì ë˜ëŠ” êµìˆ˜) -->
    {% if session.email == q.email or is_professor %}
    <div class="mb-2">
      <form method="POST" action="{{ url_for('edit_question', q_id=q.id) }}" class="d-inline">
        <input type="text" name="edited_title" placeholder="ì œëª© ìˆ˜ì •" class="form-control form-control-sm mb-1">
        <textarea name="edited_content" placeholder="ë‚´ìš© ìˆ˜ì •" class="form-control form-control-sm mb-1"></textarea>
        <button type="submit" class="btn btn-sm btn-outline-secondary">ìˆ˜ì •</button>
      </form>
      <form method="POST" action="{{ url_for('delete_question', q_id=q.id) }}" class="d-inline">
        <button type="submit" class="btn btn-sm btn-outline-danger">ì‚­ì œ</button>
      </form>
    </div>
    {% endif %}

    <!-- ğŸ’¬ ëŒ“ê¸€ ëª©ë¡ -->
    <div class="border-start ps-3 mt-2">
      {% for c in comments if c.question_id == q.id %}
        <div class="bg-light rounded p-2 mb-1">
          <p class="mb-1">{{ c.comment }}</p>
          <small class="text-muted">ì‘ì„±ì: {{ c.email }} | {{ c.date }}</small>

          {% if session.email == c.email or is_professor %}
          <form method="POST" action="{{ url_for('edit_comment', q_id=q.id, c_idx=loop.index0) }}" class="mt-1">
            <input type="text" name="edited_comment" class="form-control form-control-sm mb-1" placeholder="ëŒ“ê¸€ ìˆ˜ì •">
            <button type="submit" class="btn btn-sm btn-outline-secondary">ìˆ˜ì •</button>
          </form>
          <form method="POST" action="{{ url_for('delete_comment', q_id=q.id, c_idx=loop.index0) }}" class="d-inline">
            <button type="submit" class="btn btn-sm btn-outline-danger">ì‚­ì œ</button>
          </form>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    <!-- ğŸ’­ ëŒ“ê¸€ ì¶”ê°€ -->
    <form method="POST" action="{{ url_for('add_comment', q_id=q.id) }}" class="mt-2">
      <input type="text" name="comment" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" class="form-control form-control-sm mb-1" required>
      <button type="submit" class="btn btn-sm btn-success">ëŒ“ê¸€ ë“±ë¡</button>
    </form>
  </div>
  {% endfor %}
{% else %}
  <p class="text-muted">ë“±ë¡ëœ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>
{% endif %}

{% endblock %}
