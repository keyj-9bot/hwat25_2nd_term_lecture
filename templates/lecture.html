{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h3>ğŸ“˜ ê°•ì˜ìë£Œ ëª©ë¡</h3>
  <table class="table table-striped table-bordered text-center align-middle">
    <!-- (ì¤‘ëµ: ê¸°ì¡´ ê°•ì˜ìë£Œ í…Œì´ë¸” ë™ì¼) -->
  </table>

  <hr class="my-4">

  <section style="background:#f8f9fa;padding:20px;border-radius:12px;">
    <h4>ğŸ’¬ í•™ìƒ ì§ˆë¬¸ ê²Œì‹œíŒ 
      <small class="text-muted">(ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬ / êµìˆ˜ ë¹„ë²ˆ: 5555)</small>
    </h4>

    <!-- ì§ˆë¬¸ ì…ë ¥ -->
    <form method="POST" onsubmit="return validateStudentForm();" class="mb-4">
      <input type="hidden" name="action" value="add_qna">
      <div class="d-flex gap-2">
        <input type="text" name="name" class="form-control" placeholder="ì´ë¦„(ì„ íƒ)" style="width:20%;">
        <input type="text" name="question" class="form-control" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”" style="width:55%;" required>
        <input type="password" id="studentPassword" name="password" maxlength="4" class="form-control" placeholder="ë¹„ë°€ë²ˆí˜¸(4ìë¦¬)" style="width:15%;" required>
        <button type="submit" class="btn btn-primary" style="width:10%;">ë“±ë¡</button>
      </div>
    </form>

    {% for item in qna %}
    <div style="background:white;border:1px solid #ddd;border-radius:10px;padding:15px;margin-bottom:18px;">
      <b>Q. {{ item["ì§ˆë¬¸"] }}</b><br>
      <small class="text-muted">({{ item["ì´ë¦„"] }}, {{ item["ë“±ë¡ì‹œê°"] }})</small>

      <!-- í•™ìƒ ì‚­ì œ -->
      <form method="POST" class="mt-2 mb-2">
        <input type="hidden" name="action" value="delete_qna">
        <input type="hidden" name="index" value="{{ loop.index0 }}">
        <input type="password" name="password" maxlength="4" placeholder="ë¹„ë°€ë²ˆí˜¸(ì§ˆë¬¸ì‚­ì œìš©)" style="width:130px;">
        <button class="btn btn-sm btn-danger">ì‚­ì œ</button>
      </form>

      <hr style="border-top:4px solid #666; margin:14px 0;">

      {% if item["ë‹µë³€"] %}
        <div class="p-2" style="background:#eef6ff;border-left:5px solid #007bff;border-radius:6px;">
          <b style="color:#007bff;">A.</b> {{ item["ë‹µë³€"] }}
          <!-- âœï¸ ìˆ˜ì • / ì‚­ì œ -->
          <form method="POST" class="d-inline ms-2">
            <input type="hidden" name="action" value="delete_reply">
            <input type="hidden" name="index" value="{{ loop.index0 }}">
            <input type="password" name="password" maxlength="4" placeholder="5555" style="width:80px;">
            <button class="btn btn-sm btn-outline-danger py-0">ì‚­ì œ</button>
          </form>
          <button class="btn btn-sm btn-outline-primary py-0 ms-1" onclick="toggleEdit({{ loop.index0 }})">âœï¸ ìˆ˜ì •</button>
        </div>

        <!-- âœï¸ ìˆ˜ì • í¼ (ìˆ¨ê¹€) -->
        <form id="editForm{{ loop.index0 }}" method="POST" class="mt-2" style="display:none;">
          <input type="hidden" name="action" value="reply_qna">
          <input type="hidden" name="index" value="{{ loop.index0 }}">
          <textarea name="reply" class="form-control mb-1" required>{{ item["ë‹µë³€"] }}</textarea>
          <input type="password" name="password" maxlength="4" placeholder="êµìˆ˜ë¹„ë²ˆ(5555)" style="width:100px;">
          <button class="btn btn-sm btn-success">ìˆ˜ì • ì™„ë£Œ</button>
        </form>
      {% else %}
        <!-- ë‹µë³€ ë“±ë¡ -->
        <form method="POST" class="mt-3">
          <input type="hidden" name="action" value="reply_qna">
          <input type="hidden" name="index" value="{{ loop.index0 }}">
          <textarea name="reply" placeholder="êµìˆ˜ ë‹µë³€ ì…ë ¥..." class="form-control mb-1" required>{{ temp_reply if wrong_pw_index == loop.index0 else "" }}</textarea>
          <input type="password" name="password" maxlength="4" placeholder="êµìˆ˜ë¹„ë²ˆ(5555)" style="width:100px;">
          <button class="btn btn-sm btn-success">ë‹µë³€ ë“±ë¡</button>
        </form>
      {% endif %}
    </div>
    {% endfor %}
  </section>
</div>

<script>
function validateStudentForm() {
  const pw = document.getElementById('studentPassword').value.trim();
  if (!/^\d{4}$/.test(pw)) {
    alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš” (ìˆ«ì 4ìë¦¬)');
    return false;
  }
  return true;
}

function toggleEdit(idx) {
  const form = document.getElementById('editForm' + idx);
  form.style.display = (form.style.display === 'none' ? 'block' : 'none');
}
</script>
{% endblock %}
